### IslaBooks 需求规格说明书（Versioned Requirements）

#### 文档信息
- 版本: v0.1.2
- 日期: 2025-08-27
- 状态: 初始版本（基于 README.md 落地）
- 来源: `README.md`

#### 变更记录
| 日期 | 版本 | 更改 | 作者 |
| --- | --- | --- | --- |
| 2025-08-27 | v0.1.2 | 移除所有社区相关功能：移除书评/短评/分享/打卡/挑战等社交功能，专注于个人阅读体验 | 郭亮 |
| 2025-08-27 | v0.1.1 | 上下文方案改为非 RAG：基于选区段落+相邻段落+章/书元数据；移除向量库依赖 | 郭亮 |
| 2025-08-27 | v0.1 | 创建文档，基于 `README.md` 首次落地为版本化需求 | 郭亮 |

---

### 一句话愿景
把每本书变成一位可对话的导师：获取、阅读、理解与交流，一站式完成。

### 项目背景与目标
- **问题**: 电子书阅读存在“获取难、读不懂、读不完、记不住、无人交流”。
- **策略**: 仅支持用户本地导入作为书源；不提供任何外部下载/聚合功能；结合 AI 实时摘要、对话式理解、个性化推荐与社区互动，提升阅读效率与乐趣。
- **设备**: iOS/iPadOS 首发，支持 iPad 与 iPhone。
- **版权**: 个人开发者，无图书版权；应用不提供外部书源获取；用户通过本地文件导入合规内容。

### 目标用户与角色
- **学习型读者**: 需要高效理解与总结书本知识。
- **轻阅读用户**: 希望获得书单推荐和快速阅读。

### 用户故事
#### 学习型读者
- 从本地或“文件”App 导入 ePub/纯文本书籍。
- 首次打开书籍看到 AI 导读摘要（核心观点、章节结构、关键术语）。
- 阅读中选中段落可请求翻译、术语解释、示例说明或对比概念，并附引用与章节位置。
- 对当前章节/整本书进行问答，获得含引用的严谨回答，并可多轮追问。
- 打开新书时得到 3-5 道理解诊断题，答题后系统给出解析与后续建议。
- 高亮、笔记可一键生成“知识点卡片”，支持复习与检索。
- 创建生词本/术语表，由 AI 自动补充定义与例句。
- 阅读进度、书签、划线与笔记支持 iCloud 自动同步；可选择仅本地保存。
- 笔记/卡片可导出为 Markdown/CSV（可选，若推出 macOS 版本）。

#### 轻阅读用户
- 浏览 AI 推荐书单（每日精选、热门趋势、主题合集），一键加入书架。
- 打开书可切换“快速摘要模式”，用 1 分钟了解大意与看点。
- 向 AI 提问“这章讲了什么”“有没有更轻松的书”，获得精炼回答与替代推荐。

- 阅读进度自动保存，并可设置阅读提醒（每日/每周目标）。
- 可调整字体、行距与夜间模式，获得舒适的阅读体验。

### 关键功能清单
- 本地导入：从“文件”App/iCloud Drive/本机导入 ePub/纯文本并解析。
- AI 摘要：打开书籍时即时生成章节/全书摘要，支持缓存与更新。
- 阅读器：目录、书签、进度、划线与注释、全文检索、主题与排版设置、夜间模式、离线缓存。
- AI 对话：选区问答与整章/整书上下文问答；翻译、解释、总结、观点；引用原文与页码位置。
- AI 推荐：基于兴趣、行为与主题的个性化书单；支持冷启动策略与热门趋势。

- 理解诊断与学习建议：打开书籍时自动生成测验（选择/问答），即时反馈与后续建议。
- 账号与同步：使用 iCloud/CloudKit，无应用内注册；跨设备同步；隐私控制与仅本地保存。

### 功能说明与验收标准
- 本地导入
  - 功能：从本地或“文件”App 选择 ePub/纯文本文件导入到书架并解析渲染。
  - 验收：成功选择文件后可加入书架；在阅读器中正常渲染目录与正文。
- AI 摘要
  - 功能：首次打开书籍生成导读摘要；支持章节级摘要与全文级综述；可手动刷新。
  - 验收：摘要在 5 秒内开始流式输出；摘要含要点与目录映射；缓存命中可秒开。
- 阅读器
  - 功能：目录跳转、页内搜索、书签、划线、注释、进度同步、主题/字体/行距/夜间模式、离线阅读。
  - 验收：基础操作无明显卡顿（>60fps）；离线后可阅读已缓存书籍与笔记。
- AI 对话（阅读助手）
  - 功能：对选区/当前章节/全书进行翻译、解释、总结、观点回答；附引用出处；支持继续追问与多轮上下文。
  - 验收：选区问答在 3 秒内开始流式响应；回答含至少一个引用；可切换“更严谨/更简洁”模式。
- AI 推荐
  - 功能：基于阅读历史、偏好标签、停留时长等行为构建画像；提供每日/每周推荐书单与主题合集。
  - 验收：冷启动时提供通用优质榜单；使用 3 天后推荐点击率提升。

- 理解诊断与建议
  - 功能：自动生成理解测验（2-5 题起步），即时评分与解析；给出后续阅读路径或辅助资料建议。
  - 验收：题目覆盖书籍主要概念；答案含引用原文段落；建议可一键加入“学习计划”。
- 账号与同步
  - 功能：使用 iCloud/CloudKit 自动同步；无应用内注册；支持导入/导出与仅本地保存；提供云数据删除入口。
  - 验收：同一 Apple ID 设备间进度/书签/笔记一致；可在设置中关闭 iCloud 同步并保留本地；可一键清空 CloudKit 私有数据。

### 交互与信息架构
- 导航结构：发现（推荐/榜单/主题）— 阅读（我的书架/进度）— 我的（账号/设置）。
- 阅读器交互：
  - 选区浮层：翻译/解释/总结/提问/高亮/做题。
  - 侧边栏：AI 聊天、参考文献、知识点卡片、章节大纲。
  - 页眉：标题、目录、搜索、显示设置、同步状态。
- AI 会话设计：
  - 模式：选区问答、章节问答、跨书问答。
  - 上下文：基于选区所在自然段落 + 前后相邻 N 段（默认 1-2）+ 本章标题/书名/作者/语言/章节位置等元数据；不使用向量检索或 RAG。
  - 可视化：答案内联引用，点击可定位原文；支持导出为笔记卡片。

### 非功能性需求
- 性能
  - 打开本地已缓存书籍：<2 秒；首次解析 ePub：<5 秒。
  - AI 摘要/问答：<5 秒开始流式输出；P95 <10 秒完成。
- 稳定性与容错
  - 网络失败自动重试；AI 超时降级到简要回答或延迟生成。
- 隐私与安全
  - 最小化采集；用户可导出与删除数据；AI 请求脱敏；遵守版权与来源标注。
- 成本与速率
  - 配额与熔断；请求合并与缓存；可选开源/商业模型；显式成本提示。
- 可用性与可访问性
  - 夜间/高对比度；键盘与屏幕阅读器支持；移动端优先。
- 国际化
  - 多语言 UI；跨语言书籍与翻译。

### AI 设计与实现要点
- 模型与能力：
  - 基础对话/摘要：通用大模型；翻译：强多语模型。
- 提示工程：
  - 结构化输出（要点、关键概念、术语表）；显式要求引用原文与章节位置。
- 上下文构建（非 RAG）：
  - 选区→段落边界扩展（句/段对齐）；可配置相邻段落数与总字数上限。
  - 附加元数据：章节标题、章节序号、书名、作者、语言、出版信息（若有）、位置标记。
  - 不进行嵌入/向量化与召回流程，降低存储与流程开销。
- 流式与思考链：
  - 采用流式输出；在摘要/解释时启用简化思考链，控制成本与时延。
- 幻觉与安全：
  - 引用强制；未命中原文时标示“推断”；敏感请求加防护与拒绝策略。

### 数据来源与版权
- 书源：用户本地导入（应用不提供外部下载或抓取）。
- 版权：用户对导入内容负责；应用提供版权提示；社区内容遵循用户协议。

### 技术架构概览（初稿）
- 客户端：iOS/iPadOS（首发）。
- 服务端：AI 网关、上下文构建服务（规则式，无向量库）、推荐服务、社区与任务服务（无内容抓取/下载）。
- 存储：关系型数据库（核心业务）、本地文件存储（书文件与封面缓存）、缓存（会话/摘要缓存）。
- 数据同步（用户数据）：iCloud/CloudKit（私有数据库），无应用内注册；可关闭与删除云数据。
- 实时交互：WebSocket/Server-Sent Events 用于流式与实时互动。

### 数据模型草案（简化）
- User（本地设置）：id，settings（不采集邮箱）；iCloud 用于标识同步，不存储个人标识。
- Book：id，title，authors，language，source（固定为 local），metadata。
- BookFile：id，bookId，format，uri，checksum。
- LibraryItem：userId，bookId，status（在读/已读/想读），tags。
- ReadingProgress：userId，bookId，location，updatedAt。
- Highlight：id，userId，bookId，range，note，createdAt。
- Annotation：id，userId，bookId，content，range，createdAt。

- Quiz：id，bookId，userId，questions[]，createdAt。
- RecommendationEvent：userId，bookId，eventType，timestamp。

### API 草案（选摘）
- Import：本地文件导入（无服务端 API）。
- Reader：/progress，/highlights，/annotations。
- AI：
  - /ai/summary（bookId|chapterId）。
  - /ai/qa（scope: selection|chapter|book，text|range）。
  - /ai/quiz/generate（bookId）。
- Recommend：/feed，/lists，/trending。

- Analytics：/events（阅读/AI/交互）。

### 里程碑与范围
- v0.1 MVP
  - 本地文件导入、ePub 渲染、阅读器基础（目录/书签/进度/主题）。
  - 打开书籍的 AI 导读摘要（缓存）、选区问答（翻译/解释/总结 + 引用）。
  - iCloud 最小同步（进度）；离线缓存；无应用内注册。
- v0.2
  - 个性化推荐书单、iCloud 完整同步（进度/书签/划线/笔记）。
- v0.3
  - 理解诊断测验与学习建议、统计面板。
- v1.0
  - 性能与稳定性优化、移动端发布、合规与成本治理完善。

### 成功指标（示例）
- 次日/7 日留存、平均阅读时长、单次会话 AI 问答量。
- 推荐点击率/添加到书架率、测验完成率与正确率。
- AI 请求成功率与平均首字延迟、成本/DAU。

### 风险与对策
- 版权与合规：严格限定公共领域内容与标注来源；审核与举报机制。
- AI 幻觉：引用强制、未命中提示、段落优先、本地上下文优先。
- 成本与速率：缓存、批量/合并、异步/延迟生成、用户配额与开关。
- 复杂度与体验：分阶段发布、优先核心路径（获取-阅读-理解）。

### 合规与审核清单（上线必过）
- App Store Review Guidelines（重点）
  - 5.1 隐私：最小化采集；提供用途说明、隐私政策 URL、数据删除入口。
  - 5.1.1 权限：首次使用前申请系统权限；`Info.plist` 必填用途描述（如 `NSCameraUsageDescription`）。
  - 5.1.3 账号删除：在应用内提供“账号删除”，明确后果，并删除服务器侧数据。
  - 3.1 支付：数字内容/功能必须使用 IAP/订阅；不得绕过或引导外部支付。
  - 2.3 元数据：名称/副标题/关键词/截图/预览需真实反映功能，不得含测试或占位内容。
  - 4.2 质量：功能完整，不崩溃；避免“网页壳”与内容不足。
  - 推送与背景：推送仅用于用户价值场景且可关闭；后台模式/位置等权限须与功能强相关。
  - 生成式 AI：标注来源/免责声明；避免不当内容并提供举报与屏蔽能力。
- Human Interface Guidelines（HIG）
  - 导航/层级清晰；触控目标 ≥44pt；支持动态字体与浅/深色模式。
  - 图标、启动屏与多分辨率资源齐备；iPad 适配与多任务支持（阅读器关键）。
- 隐私与数据
  - App Privacy Nutrition Label 准确申报数据类型/用途；最小化采集与存储周期。
  - ATT（AppTrackingTransparency）仅在确需跨 App 跟踪时申请，并清晰说明场景与价值。
  - 提供“隐私政策”“服务条款”链接；支持数据导出与删除。
- IslaBooks 特定要求
  - 书源与版权：仅使用公共领域/合规来源，标注 Project Gutenberg 等出处与许可。
  - AI 回答：显示出处引用；未命中原文时标注“推断”。

  - 离线缓存：说明缓存范围与清除入口。

### 提交前检查清单（Submit Checklist）
- 功能稳定：崩溃率低；冷/热启动与核心路径通过验收用例。
- 权限与用途：`Info.plist` 权限描述完整且与实际一致；仅在需要时申请。
- 账号与支付：账号删除完整闭环；IAP/订阅配置与商品元数据正确。
- 元数据与素材：名称/描述/关键词/截图/预览视频真实准确；隐私标签填写一致。
- 技术配置：ATS、后台模式、推送、通知类别、Universal Links、深色模式适配完成。

### 隐私与合规声明（产品级）
- 应用仅支持用户本地导入书籍文件，不提供任何外部下载/抓取/聚合功能。
- 使用 iCloud/CloudKit 进行用户数据同步；无应用内注册；可关闭同步与删除云端数据。
- 对 AI 生成内容提供引用与来源标注；未命中原文时明确为“推断”。

### 开放问题
- 是否支持 PDF/扫描版与 OCR？优先度？
- 推荐是否引入协同过滤与社交关系？
- 社区内容的审核与分发机制？
- 是否提供付费订阅（高级模型、更多配额）？
- 教育场景下的班级/作业管理是否纳入 v1.0？

### 术语表
- 选区问答：基于用户高亮/选择的片段进行上下文问答。
- 上下文构建（非 RAG）：按选区段落 + 相邻段落 + 章/书元数据构建提示上下文。
- 引用：回答中给出的原文出处标注（章节/段落/位置）。

### 参考链接
- [App Store Review Guidelines](https://developer.apple.com/app-store/review/guidelines/)
- [Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/)
- [App Privacy Details](https://developer.apple.com/app-store/app-privacy-details/)
- [App Tracking Transparency](https://developer.apple.com/documentation/apptrackingtransparency)

---

### 附注
本文件为版本化需求文档（requirements），后续变更请在“变更记录”中逐条登记，并在文档顶部更新版本号与日期。


